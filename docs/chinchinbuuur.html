<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <title>Chinchinbuuur - Belenbuuur Fotografia</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="chinchinbuuur-page">
    <!-- Hero + navegación principal -->
    <section class="hero" id="hero">
        <nav class="navbar">
            <div class="container">
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="galeria.html">Galeria</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>
            </div>
        </nav>
        <img src="media/logos/Chinchinbuuur.png" alt="Fondo Hero Chinchinbuuur" class="hero-bg">
    </section>

    <main>
        <!-- Listado de álbumes -->
        <section class="albumes" id="albumes">
            <div class="container">
                <div class="albumes-header">
                    <h1>Chinchinbuuur</h1>
                    <p>Selecciona un album para ver todas sus fotos.</p>
                </div>
                <div id="album-list" class="album-grid" aria-live="polite"></div>
            </div>
        </section>

        <!-- Visor del álbum seleccionado -->
        <section class="album-view" id="album-view">
            <div class="container">
                <div class="album-view-header">
                    <div>
                        <h2 id="album-title">Elige un album</h2>
                        <p id="album-meta">Selecciona un album para cargar las fotos.</p>
                    </div>
                </div>
                <div id="photo-grid" class="photo-grid" aria-live="polite"></div>
            </div>
        </section>
    </main>

    <!-- Lightbox para ver fotos en grande -->
    <div id="lightbox" class="lightbox" aria-hidden="true">
        <button class="lightbox-close" type="button" aria-label="Cerrar">×</button>
        <button class="lightbox-prev" type="button" aria-label="Anterior">‹</button>
        <img id="lightbox-image" alt="">
        <button class="lightbox-next" type="button" aria-label="Siguiente">›</button>
        <div id="lightbox-caption" class="lightbox-caption"></div>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script>
        // Datos base de álbumes y fotos
        const rawAlbums = [
            {
                folder: "2020-09-04-Chinchinbuuur-Boda-Sandra-y-Joan-4-de-septiembre-de-2020",
                title: "Boda Sandra y Joan 4 de septiembre de 2020",
                files: ["_MG_4890.jpg", "_MG_4917.jpg", "_MG_4949.jpg", "_MG_4962.jpg", "_MG_4969.jpg", "_MG_4972.jpg", "_MG_4976.jpg", "_MG_4985.jpg", "_MG_4986.jpg", "_MG_5067.jpg", "_MG_5083.jpg", "_MG_5117.jpg", "_MG_5135.jpg", "_MG_5137.jpg", "_MG_5142-2.jpg", "_MG_5145-2.jpg"]
            },
            {
                folder: "2019-05-26-Chinchinbuuur-Comunión-Patri-26-de-mayo-de-2019",
                title: " Patri 26 de mayo de 2019",
                files: ["IMG_9703.jpg", "IMG_9709.jpg", "IMG_9711.jpg", "IMG_9733.jpg", "IMG_9772.jpg"]
            },
            {
                folder: "2018-09-29-Chinchinbuuur-Boda-Ana-y-Jose-29-de-septiembre-de-2018",
                title: "Boda Ana y Jose 29 de septiembre de 2018",
                files: ["IMG_6015.jpg", "IMG_6025.jpg", "IMG_6178.jpg", "IMG_6247.jpg", "IMG_6253.jpg", "IMG_6309.jpg", "IMG_6506.jpg", "IMG_6510.jpg", "IMG_6597.jpg", "IMG_7068.jpg", "IMG_7196.jpg", "IMG_7225.jpg"]
            }
        ];

        // Filtra álbumes vacíos
        const albums = rawAlbums.filter((album) => Array.isArray(album.files) && album.files.length > 0);

        // Referencias al DOM
        const albumListEl = document.getElementById("album-list");
        const photoGridEl = document.getElementById("photo-grid");
        const albumTitleEl = document.getElementById("album-title");
        const albumMetaEl = document.getElementById("album-meta");

        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightbox-image");
        const lightboxCaption = document.getElementById("lightbox-caption");
        const lightboxClose = document.querySelector(".lightbox-close");
        const lightboxPrev = document.querySelector(".lightbox-prev");
        const lightboxNext = document.querySelector(".lightbox-next");

        // Estado de navegación
        let activeAlbumIndex = 0;
        let activePhotoIndex = 0;

        // Utilidad: construir la ruta de una imagen
        const buildImageSrc = (folder, file) => {
            const encodedFolder = encodeURIComponent(folder);
            const encodedFile = encodeURIComponent(file);
            return `media/img/${encodedFolder}/${encodedFile}`;
        };

        // Renderiza la lista de álbumes
        const renderAlbumList = () => {
            albumListEl.innerHTML = "";

            albums.forEach((album, index) => {
                const coverSrc = buildImageSrc(album.folder, album.files[0]);
                const card = document.createElement("button");
                card.type = "button";
                card.className = "album-card" + (index === activeAlbumIndex ? " is-active" : "");
                card.style.setProperty("--album-cover", `url("${coverSrc}")`);
                card.dataset.index = index.toString();
                // Separa título y fecha para una lectura más clara
                const titleParts = album.title.match(/^(.+?)\s+(\d{1,2}\s+(?:de\s+)?\w+\s+(?:a|y)?\s*\d*\s*(?:de\s+)?\w*\s*(?:de\s+)?\d{4})$/)
                    || [null, album.title, ''];
                const mainTitle = titleParts[1];
                const dateStr = titleParts[2];
                
                card.innerHTML = `
                    <span class="album-card-overlay"></span>
                    <span class="album-card-content">
                        <span class="album-card-title">${mainTitle}</span>
                        ${dateStr ? `<span class="album-card-date">${dateStr}</span>` : ''}
                        <span class="album-card-count">${album.files.length} fotos</span>
                    </span>
                `;
                card.addEventListener("click", () => {
                    activeAlbumIndex = index;
                    renderAlbumList();
                    renderAlbumPhotos();
                    // Scroll automático al album-view
                    document.getElementById("album-view").scrollIntoView({ behavior: "smooth", block: "start" });
                });
                albumListEl.appendChild(card);
            });
        };

        // Renderiza las fotos del álbum activo
        const renderAlbumPhotos = () => {
            const album = albums[activeAlbumIndex];
            if (!album) {
                albumTitleEl.textContent = "Elige un album";
                albumMetaEl.textContent = "Selecciona un album para cargar las fotos.";
                photoGridEl.innerHTML = "";
                return;
            }

            albumTitleEl.textContent = album.title;
            albumMetaEl.textContent = `${album.files.length} fotos`;
            photoGridEl.innerHTML = "";

            album.files.forEach((file, index) => {
                const src = buildImageSrc(album.folder, file);
                const button = document.createElement("button");
                button.type = "button";
                button.className = "photo-item";
                button.innerHTML = `<img src="${src}" alt="${album.title} ${index + 1}" loading="lazy">`;
                button.addEventListener("click", () => {
                    openLightbox(album, index);
                });
                photoGridEl.appendChild(button);
            });
        };

        // Abre el lightbox en la foto seleccionada
        const openLightbox = (album, index) => {
            activePhotoIndex = index;
            updateLightbox(album);
            lightbox.classList.add("is-open");
            lightbox.setAttribute("aria-hidden", "false");
            document.body.classList.add("lightbox-open");
        };

        // Cierra el lightbox y restablece el scroll
        const closeLightbox = () => {
            lightbox.classList.remove("is-open");
            lightbox.setAttribute("aria-hidden", "true");
            document.body.classList.remove("lightbox-open");
        };

        // Actualiza imagen y pie de foto del lightbox
        const updateLightbox = (album) => {
            const file = album.files[activePhotoIndex];
            const src = buildImageSrc(album.folder, file);
            lightboxImage.src = src;
            lightboxImage.alt = `${album.title} ${activePhotoIndex + 1}`;
            lightboxCaption.textContent = `${album.title} (${activePhotoIndex + 1}/${album.files.length})`;
        };

        // Avanza o retrocede dentro del álbum
        const stepPhoto = (direction) => {
            const album = albums[activeAlbumIndex];
            if (!album) return;
            activePhotoIndex = (activePhotoIndex + direction + album.files.length) % album.files.length;
            updateLightbox(album);
        };

        lightboxClose.addEventListener("click", closeLightbox);
        lightboxPrev.addEventListener("click", () => stepPhoto(-1));
        lightboxNext.addEventListener("click", () => stepPhoto(1));
        lightbox.addEventListener("click", (event) => {
            if (event.target === lightbox) {
                closeLightbox();
            }
        });
        document.addEventListener("keydown", (event) => {
            if (!lightbox.classList.contains("is-open")) return;
            if (event.key === "Escape") closeLightbox();
            if (event.key === "ArrowLeft") stepPhoto(-1);
            if (event.key === "ArrowRight") stepPhoto(1);
        });

        renderAlbumList();
        renderAlbumPhotos();
    </script>
</body>
</html>
